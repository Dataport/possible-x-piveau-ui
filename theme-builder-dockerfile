FROM node:18-alpine

#
# BUILD START
#

COPY . /App

# RUN cd /App && \
#  cp -a src original_src && \
#  npm ci && \
#  cp config/user-config.sample.js config/user-config.js && \
#  npm run build && \
#  mv dist/* /usr/share/nginx/html/ && \
#  rm -r node_modules

RUN mkdir -p /usr/share/nginx/html/

#
# BUILD END
#

# Rebuilds the application on start
CMD [ "/bin/sh", "-c", "cd /App && cp -a src original_src && npm --silent ci && cp config/user-config.sample.js config/user-config.js && npm run --silent build && cp -a dist/* /usr/share/nginx/html/ && rm -r dist && rm -r node_modules" ]
